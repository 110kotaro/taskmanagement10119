# 権限管理のテスト手順

## 実装内容

権限管理システムが実装されました。以下の機能が追加されています：

1. **閲覧権限**: タスクの閲覧は管理者、作成者、担当者のみ可能
2. **編集権限**: タスクの編集は管理者、作成者、担当者のみ可能
3. **削除権限**: タスクの削除は管理者、作成者のみ可能（担当者は削除不可）

## テスト手順

### 1. テスト環境の準備

#### 1.1 ユーザーアカウントの準備
- 管理者アカウント（role: 'admin'）を1つ作成
- 一般ユーザーアカウント（role: 'user'）を2つ作成（UserA、UserB）

#### 1.2 ユーザーのroleを設定
Firestoreの`users`コレクションで、各ユーザーの`role`フィールドを設定：
- 管理者: `role: 'admin'`
- 一般ユーザー: `role: 'user'`

### 2. タスクの作成と権限の確認

#### 2.1 タスク作成
1. UserAでログイン
2. 新しいタスクを作成（作成者: UserA、担当者: UserB）
3. 別のタスクを作成（作成者: UserA、担当者: UserA）
4. 別のタスクを作成（作成者: UserA、担当者: 未割当）

#### 2.2 閲覧権限のテスト
1. **UserAでログイン**（作成者）
   - 自分が作成した全てのタスクが表示されることを確認
   - 自分が担当者になっているタスクが表示されることを確認

2. **UserBでログイン**（担当者）
   - 自分が担当者になっているタスクが表示されることを確認
   - 自分が作成者でも担当者でもないタスクは表示されないことを確認

3. **管理者でログイン**
   - 全てのタスクが表示されることを確認

#### 2.3 編集権限のテスト
1. **UserAでログイン**
   - 自分が作成したタスクの編集ボタンが表示されることを確認
   - 自分が担当者になっているタスクの編集ボタンが表示されることを確認
   - 編集ボタンをクリックして編集できることを確認

2. **UserBでログイン**
   - 自分が担当者になっているタスクの編集ボタンが表示されることを確認
   - 編集ボタンをクリックして編集できることを確認
   - 自分が作成者でも担当者でもないタスクでは編集ボタンが表示されないことを確認

3. **管理者でログイン**
   - 全てのタスクの編集ボタンが表示されることを確認
   - 編集ボタンをクリックして編集できることを確認

#### 2.4 削除権限のテスト
1. **UserAでログイン**（作成者）
   - 自分が作成したタスクの削除ボタンが表示されることを確認
   - 削除ボタンをクリックして削除できることを確認
   - 自分が担当者だけのタスクでは削除ボタンが表示されないことを確認

2. **UserBでログイン**（担当者）
   - 自分が担当者になっているタスクでは削除ボタンが表示されないことを確認

3. **管理者でログイン**
   - 全てのタスクの削除ボタンが表示されることを確認
   - 削除ボタンをクリックして削除できることを確認

### 3. タスク一覧での権限チェック

#### 3.1 タスク一覧ページでの確認
1. **UserAでログイン**
   - タスク一覧ページで自分が作成者または担当者のタスクのみが表示されることを確認

2. **UserBでログイン**
   - タスク一覧ページで自分が作成者または担当者のタスクのみが表示されることを確認

3. **管理者でログイン**
   - タスク一覧ページで全てのタスクが表示されることを確認

### 4. エラーハンドリングのテスト

#### 4.1 権限がない場合の編集試行
1. UserBでログイン
2. 自分が作成者でも担当者でもないタスクのURLを直接入力してアクセス
3. 編集ボタンが表示されないことを確認
4. 直接APIを呼び出そうとした場合、エラーメッセージが表示されることを確認

#### 4.2 権限がない場合の削除試行
1. UserBでログイン
2. 自分が担当者だけのタスクのURLを直接入力してアクセス
3. 削除ボタンが表示されないことを確認
4. 直接APIを呼び出そうとした場合、エラーメッセージが表示されることを確認

### 5. コンソールログの確認

開発者ツールのコンソールで、以下のログが表示されることを確認：
- 権限チェックが正常に実行されている
- エラーが発生した場合、適切なエラーメッセージが表示される

## 期待される動作

### 管理者（Admin）
- ✅ 全てのタスクを閲覧可能
- ✅ 全てのタスクを編集可能
- ✅ 全てのタスクを削除可能

### 作成者（Creator）
- ✅ 自分が作成したタスクを閲覧可能
- ✅ 自分が作成したタスクを編集可能
- ✅ 自分が作成したタスクを削除可能
- ✅ 自分が担当者になっているタスクを閲覧可能
- ✅ 自分が担当者になっているタスクを編集可能
- ❌ 自分が担当者だけのタスクは削除不可

### 担当者（Assignee）
- ✅ 自分が担当者になっているタスクを閲覧可能
- ✅ 自分が担当者になっているタスクを編集可能
- ❌ 自分が担当者だけのタスクは削除不可
- ❌ 自分が作成者でも担当者でもないタスクは閲覧・編集・削除不可

## トラブルシューティング

### 権限が正しく機能しない場合
1. Firestoreの`users`コレクションで、ユーザーの`role`フィールドが正しく設定されているか確認
2. ブラウザのコンソールでエラーメッセージを確認
3. ログアウトして再ログインしてみる
4. ブラウザのキャッシュをクリアして再試行

### タスクが表示されない場合
1. タスクの`creatorId`または`assigneeId`が正しく設定されているか確認
2. タスクの`isDeleted`フィールドが`false`になっているか確認
3. ユーザーの`role`が正しく設定されているか確認

## 注意事項

- 権限チェックは、タスクの読み込み時に実行されます
- 権限がない場合、UI上でボタンが非表示になります
- 直接APIを呼び出した場合でも、サーバー側で権限チェックが行われ、エラーが返されます
- 管理者は全てのタスクに対して全権限を持ちます

