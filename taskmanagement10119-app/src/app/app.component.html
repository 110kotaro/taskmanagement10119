<div class="app-container" [class.sidebar-closed]="!isSidebarOpen" *ngIf="isLoggedIn && authInitialized">
  <!-- サイドバーが閉じたときのトグルボタン（左端に固定） -->
  <button 
    *ngIf="!isSidebarOpen"
    class="sidebar-toggle-fixed" 
    (click)="toggleSidebar()"
    title="サイドバーを開く">
    →
  </button>
  
  <!-- サイドバー -->
  <aside class="sidebar" [class.open]="isSidebarOpen" [class.closed]="!isSidebarOpen">
    <div class="sidebar-header">
      <h2>タスク管理</h2>
      <button class="sidebar-toggle" (click)="toggleSidebar()" title="サイドバーを閉じる">
        ←
      </button>
    </div>
    <nav class="sidebar-nav">
      <button 
        class="nav-item" 
        [class.active]="isActiveRoute('/home')"
        (click)="viewHome()">
        🏠 ホーム
      </button>
      <button 
        class="nav-item" 
        [class.active]="isActiveRoute('/task-list')"
        (click)="viewTaskList()">
        📋 タスク一覧
      </button>
      <button 
        class="nav-item" 
        [class.active]="isActiveRoute('/projects')"
        (click)="viewProjects()">
        📁 プロジェクト一覧
      </button>
      <button 
        class="nav-item" 
        [class.active]="isActiveRoute('/teams')"
        (click)="viewTeams()">
        👥 チーム管理
      </button>
      <button 
        class="nav-item" 
        [class.active]="isActiveRoute('/gantt')"
        (click)="viewGantt()">
        📊 ガントチャート
      </button>
      <button 
        class="nav-item" 
        [class.active]="isActiveRoute('/statistics')"
        (click)="viewStatistics()">
        📈 統計
      </button>
      <button 
        class="nav-item" 
        [class.active]="isActiveRoute('/comments')"
        (click)="viewComments()">
        💬 コメント一覧
      </button>
      <button 
        class="nav-item notifications-item" 
        [class.active]="isActiveRoute('/notifications')"
        (click)="viewNotifications()">
        <span>🔔 お知らせ</span>
        <span class="badge" *ngIf="unreadCount > 0">{{ unreadCount }}</span>
      </button>
      <button 
        class="nav-item" 
        [class.active]="isActiveRoute('/task-import')"
        (click)="viewTaskImport()">
        📥 タスクインポート
      </button>
      <button 
        class="nav-item" 
        [class.active]="isActiveRoute('/archive')"
        (click)="viewArchive()">
        📦 アーカイブ
      </button>
      <button 
        class="nav-item" 
        [class.active]="isActiveRoute('/settings')"
        (click)="viewSettings()">
        ⚙️ 設定
      </button>
      <button 
        class="nav-item" 
        [class.active]="isActiveRoute('/account')"
        (click)="viewAccount()">
        👤 アカウント情報
      </button>
      
      <!-- 個人/チーム切り替え -->
      <div class="view-mode-toggle" *ngIf="userTeams.length > 0">
        <button 
          class="mode-btn" 
          [class.active]="viewMode === 'personal'"
          (click)="onViewModeChange('personal')">
          個人
        </button>
        <button 
          class="mode-btn" 
          [class.active]="viewMode === 'team'"
          (click)="onViewModeChange('team')">
          チーム
        </button>
        <select 
          *ngIf="viewMode === 'team' && userTeams.length > 0"
          class="team-select"
          [(ngModel)]="selectedTeamId"
          (ngModelChange)="onTeamChange($event)">
          <option *ngFor="let team of userTeams" [value]="team.id">
            {{ team.name }}
          </option>
        </select>
      </div>
    </nav>
  </aside>

  <!-- メインコンテンツエリア -->
  <main class="main-content-area" [class.sidebar-open]="isSidebarOpen">
    <router-outlet />
  </main>
</div>

<!-- ログイン画面ではサイドバーを表示しない -->
<div class="app-container" *ngIf="!isLoggedIn && authInitialized">
  <router-outlet />
</div>

<!-- 認証状態の初期化中はローディング表示 -->
<div class="loading-container" *ngIf="!authInitialized">
  <div class="loading-spinner">読み込み中...</div>
</div>

<!-- ステータス変更確認モーダル -->
<app-status-change-confirmation
  *ngIf="showStatusConfirmation && currentConfirmationTask"
  [task]="currentConfirmationTask.task"
  [checkType]="currentConfirmationTask.checkType"
  (actionSelected)="onConfirmationAction($event)"
  (closed)="onConfirmationClosed()">
</app-status-change-confirmation>

<!-- 終了日変更モーダル -->
<app-end-date-change
  *ngIf="showEndDateChange && currentConfirmationTask"
  [task]="currentConfirmationTask.task"
  (cancelled)="onEndDateChangeCancelled()"
  (updated)="onEndDateUpdated($event)">
</app-end-date-change>

<!-- プロジェクト完了確認モーダル -->
<app-project-completion-confirmation
  *ngIf="showProjectCompletionConfirmation && currentConfirmationProject"
  [project]="currentConfirmationProject.project"
  (actionSelected)="onProjectCompletionAction($event)"
  (closed)="onProjectConfirmationClosed()">
</app-project-completion-confirmation>

<!-- プロジェクト終了日確認モーダル -->
<app-project-end-date-confirmation
  *ngIf="showProjectEndDateConfirmation && currentConfirmationProject"
  [project]="currentConfirmationProject.project"
  (actionSelected)="onProjectEndDateAction($event)"
  (closed)="onProjectConfirmationClosed()">
</app-project-end-date-confirmation>
