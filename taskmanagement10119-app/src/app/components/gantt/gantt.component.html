<div class="gantt-container">
  <div class="gantt-header">
    <div class="gantt-header-left">
    <button class="back-btn" (click)="goBack()">â† æˆ»ã‚‹</button>
    <h1>ğŸ“Š ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆ</h1>
    </div>
    <div class="gantt-header-right">
      <div class="view-mode-switcher">
        <button 
          class="mode-btn" 
          [class.active]="viewMode === 'tasks'"
          (click)="switchView('tasks')">
          ã‚¿ã‚¹ã‚¯
        </button>
        <button 
          class="mode-btn" 
          [class.active]="viewMode === 'projects'"
          (click)="switchView('projects')">
          ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ
        </button>
      </div>
    </div>
  </div>
  <div class="main-content">
  <div class="gantt-card">

    <div *ngIf="isLoading" class="loading">èª­ã¿è¾¼ã¿ä¸­...</div>

    <div *ngIf="!isLoading && dateRange && customDateRange && dateColumns.length > 0" class="gantt-content">

      <!-- ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¢ãƒ¼ãƒ‰ï¼‰ -->
      <div *ngIf="viewMode === 'projects' && !isLoading" class="filter-section">
        <!-- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ -->
        <div class="filter-group">
          <label class="filter-label">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:</label>
          <div class="checkbox-group">
            <label class="checkbox-label">
              <input 
                type="checkbox" 
                [checked]="projectStatusFilters.has('not_started')"
                (change)="onProjectStatusFilterChange('not_started', $any($event.target).checked)">
              <span>æœªé–‹å§‹</span>
            </label>
            <label class="checkbox-label">
              <input 
                type="checkbox" 
                [checked]="projectStatusFilters.has('in_progress')"
                (change)="onProjectStatusFilterChange('in_progress', $any($event.target).checked)">
              <span>é€²è¡Œä¸­</span>
            </label>
            <label class="checkbox-label">
              <input 
                type="checkbox" 
                [checked]="projectStatusFilters.has('completed')"
                (change)="onProjectStatusFilterChange('completed', $any($event.target).checked)">
              <span>å®Œäº†æ¸ˆã¿</span>
            </label>
          </div>
        </div>
      </div>

      <!-- ã‚½ãƒ¼ãƒˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¢ãƒ¼ãƒ‰ï¼‰ -->
      <div *ngIf="viewMode === 'projects' && !isLoading" class="sort-section">
        <div class="sort-group">
          <label>ã‚½ãƒ¼ãƒˆ:</label>
          <select [value]="projectSortBy" (change)="onProjectSortChange($any($event.target).value)">
            <option value="endDate">æœŸé™é †</option>
            <option value="createdAt">é–‹å§‹æ—¥é †</option>
            <option value="name">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåé †</option>
          </select>
          <button class="sort-order-btn" (click)="toggleProjectSortOrder()">
            {{ projectSortOrder === 'asc' ? 'æ˜‡é † â†‘ ' : 'é™é † â†“ ' }}
          </button>
        </div>
      </div>

      <!-- ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆã‚¿ã‚¹ã‚¯ãƒ¢ãƒ¼ãƒ‰ã®ã¿ï¼‰ -->
      <div *ngIf="viewMode === 'tasks' && !isLoading" class="filter-section">
        <!-- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ -->
        <div class="filter-group">
          <label class="filter-label">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:</label>
          <div class="checkbox-group">
            <label class="checkbox-label">
              <input 
                type="checkbox" 
                [checked]="statusFilters.has('not_started')"
                (change)="onStatusFilterChange('not_started', $any($event.target).checked)">
              <span>æœªç€æ‰‹</span>
            </label>
            <label class="checkbox-label">
              <input 
                type="checkbox" 
                [checked]="statusFilters.has('in_progress')"
                (change)="onStatusFilterChange('in_progress', $any($event.target).checked)">
              <span>é€²è¡Œä¸­</span>
            </label>
            <label class="checkbox-label">
              <input 
                type="checkbox" 
                [checked]="statusFilters.has('completed')"
                (change)="onStatusFilterChange('completed', $any($event.target).checked)">
              <span>å®Œäº†æ¸ˆã¿</span>
            </label>
          </div>
        </div>
        
        <!-- æœŸé™åˆ‡ã‚Œãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ï¼ˆç‹¬ç«‹ï¼‰ -->
        <div class="filter-group">
          <label class="filter-label">æœŸé™åˆ‡ã‚Œ:</label>
          <div class="checkbox-group">
            <label class="checkbox-label">
              <input 
                type="checkbox" 
                [checked]="overdueFilter"
                (change)="onOverdueFilterChange($any($event.target).checked)">
              <span>æœŸé™åˆ‡ã‚Œã‚’å«ã‚ã‚‹</span>
            </label>
          </div>
        </div>
        
        <!-- é‡è¦åº¦ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ -->
        <div class="filter-group">
          <label class="filter-label">é‡è¦åº¦:</label>
          <div class="checkbox-group">
            <label class="checkbox-label">
              <input 
                type="checkbox" 
                [checked]="priorityFilters.has('important')"
                (change)="onPriorityFilterChange('important', $any($event.target).checked)">
              <span>é‡è¦</span>
            </label>
            <label class="checkbox-label">
              <input 
                type="checkbox" 
                [checked]="priorityFilters.has('normal')"
                (change)="onPriorityFilterChange('normal', $any($event.target).checked)">
              <span>æ™®é€š</span>
            </label>
            <label class="checkbox-label">
              <input 
                type="checkbox" 
                [checked]="priorityFilters.has('low')"
                (change)="onPriorityFilterChange('low', $any($event.target).checked)">
              <span>ä½ã‚</span>
            </label>
            <label class="checkbox-label">
              <input 
                type="checkbox" 
                [checked]="priorityFilters.has('none')"
                (change)="onPriorityFilterChange('none', $any($event.target).checked)">
              <span>ãªã—</span>
            </label>
          </div>
        </div>
        
        <!-- ã‚¿ã‚¹ã‚¯ã‚¿ã‚¤ãƒ—ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ -->
        <div class="filter-group">
          <label class="filter-label">ã‚¿ã‚¹ã‚¯ã‚¿ã‚¤ãƒ—:</label>
          <div class="checkbox-group">
            <label class="checkbox-label">
              <input 
                type="checkbox" 
                [checked]="taskTypeFilters.has('normal')"
                (change)="onTaskTypeFilterChange('normal', $any($event.target).checked)">
              <span>é€šå¸¸</span>
            </label>
            <label class="checkbox-label">
              <input 
                type="checkbox" 
                [checked]="taskTypeFilters.has('meeting')"
                (change)="onTaskTypeFilterChange('meeting', $any($event.target).checked)">
              <span>ä¼šè­°</span>
            </label>
            <label class="checkbox-label">
              <input 
                type="checkbox" 
                [checked]="taskTypeFilters.has('regular')"
                (change)="onTaskTypeFilterChange('regular', $any($event.target).checked)">
              <span>å®šæœŸ</span>
            </label>
            <label class="checkbox-label">
              <input 
                type="checkbox" 
                [checked]="taskTypeFilters.has('project')"
                (change)="onTaskTypeFilterChange('project', $any($event.target).checked)">
              <span>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ</span>
            </label>
            <label class="checkbox-label">
              <input 
                type="checkbox" 
                [checked]="taskTypeFilters.has('other')"
                (change)="onTaskTypeFilterChange('other', $any($event.target).checked)">
              <span>ãã®ä»–</span>
            </label>
          </div>
        </div>
      </div>

      <!-- ã‚½ãƒ¼ãƒˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆã‚¿ã‚¹ã‚¯ãƒ¢ãƒ¼ãƒ‰ã®ã¿ï¼‰ -->
      <div *ngIf="viewMode === 'tasks' && !isLoading" class="sort-section">
        <div class="sort-group">
          <label>ã‚½ãƒ¼ãƒˆ:</label>
          <select [value]="sortBy" (change)="onSortChange($any($event.target).value)">
            <option value="endDate">æœŸé™é †</option>
            <option value="startDate">é–‹å§‹æ—¥é †</option>
            <option value="priority">é‡è¦åº¦é †</option>
            <option value="title">ã‚¿ã‚¤ãƒˆãƒ«é †</option>
          </select>
          <button class="sort-order-btn" (click)="toggleSortOrder()">
            {{ sortOrder === 'asc' ? 'æ˜‡é † â†‘ ' : 'é™é † â†“ ' }}
          </button>
        </div>
      </div>
      

      <!-- å‡¡ä¾‹ -->
      <div class="legend">
        <ng-container *ngIf="viewMode === 'tasks'">
          <div class="legend-item">
            <span class="legend-dot" style="background-color: #2196F3;"></span>
            <span>æœªç€æ‰‹</span>
          </div>
          <div class="legend-item">
            <span class="legend-dot" style="background-color: #FF9800;"></span>
            <span>é€²è¡Œä¸­</span>
          </div>
          <div class="legend-item">
            <span class="legend-dot" style="background-color: #4CAF50;"></span>
            <span>å®Œäº†</span>
          </div>
        </ng-container>
        <ng-container *ngIf="viewMode === 'projects'">
          <div class="legend-item">
            <span class="legend-dot" style="background-color: rgb(33, 150, 243);"></span>
            <span>æœªé–‹å§‹ï¼ˆ0%ï¼‰</span>
          </div>
          <div class="legend-item">
            <span class="legend-dot" style="background-color: rgb(173, 216, 243);"></span>
            <span>é–‹å§‹æ¸ˆã¿ï¼ˆ0-30%ï¼‰</span>
          </div>
          <div class="legend-item">
            <span class="legend-dot" style="background-color: rgb(173, 166, 0);"></span>
            <span>é€²è¡Œä¸­ï¼ˆ30-60%ï¼‰</span>
          </div>
          <div class="legend-item">
            <span class="legend-dot" style="background-color: rgb(255, 128, 0);"></span>
            <span>å¾ŒåŠï¼ˆ60-85%ï¼‰</span>
          </div>
          <div class="legend-item">
            <span class="legend-dot" style="background-color: rgb(76, 175, 80);"></span>
            <span>ã»ã¼å®Œäº†ï¼ˆ85-100%ï¼‰</span>
          </div>
        </ng-container>
      </div>
      
      
      <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« -->
      <div class="gantt-nav-controls">
        <!-- è¡¨ç¤ºæœŸé–“é¸æŠ -->
        <div class="display-period-selector">
        <label>è¡¨ç¤ºæœŸé–“:</label>
        <select [value]="displayPeriod" (change)="setDisplayPeriod($any($event.target).value)">
          <option value="week">1é€±é–“</option>
          <option value="twoWeeks">2é€±é–“</option>
          <option value="month">1ã‹æœˆ</option>
        </select>
        </div>
        <div class="period-change-container">
        <button class="nav-btn" (click)="moveWeekBackward()">
          {{ displayPeriod === 'month' ? 'â† å‰ã®æœˆ' : displayPeriod === 'twoWeeks' ? 'â† 2é€±é–“å‰' : 'â† 1é€±é–“å‰' }}
        </button>
        <button class="nav-btn" (click)="moveToCurrentWeek()">
          {{ displayPeriod === 'month' ? 'ä»Šæœˆ' : 'ä»Šé€±' }}
        </button>
        <button class="nav-btn" (click)="moveWeekForward()">
          {{ displayPeriod === 'month' ? 'æ¬¡ã®æœˆ â†’' : displayPeriod === 'twoWeeks' ? '2é€±é–“å¾Œ â†’' : '1é€±é–“å¾Œ â†’' }}
        </button>
        </div>
      </div>
      

      <!-- ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆ -->
      <div class="gantt-chart-wrapper" ><!--(scroll)="onScroll($event)"-->
        <!-- ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼è¡¨ç¤ºç”¨ã®å…¨æœŸé–“å¹…è¦ç´  
        <div class="gantt-scroll-area" [style.width]="getScrollbarWidth()"></div> -->
        <div class="gantt-chart" [style.grid-template-columns]="getGridTemplateColumns()">
          <!-- ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œ -->
          <div class="grid-task-label-header"
          [style.grid-row]="getHeaderRow()">ã‚¿ã‚¹ã‚¯</div>

          <!-- æœˆè¡¨ç¤ºè¡Œï¼ˆ1é€±é–“ãƒ»2é€±é–“ãƒ¢ãƒ¼ãƒ‰ã®ã¿ï¼‰ -->
          <div class="grid-month-label-header" 
               [style.grid-row]="1" 
               *ngIf="displayPeriod==='week' || displayPeriod==='twoWeeks'"></div>
          <ng-container *ngIf="displayPeriod==='week' || displayPeriod==='twoWeeks'">
            <ng-container *ngFor="let date of dateColumns; let i = index">
              <div class="grid-month-label-span"
                   *ngIf="shouldShowMonthLabel(date, i)"
                   [style.grid-column]="getMonthColumnSpan(i)?.startCol + ' / span ' + getMonthColumnSpan(i)?.span"
                   [style.grid-row]="1"
                   [class.month-end]="i === dateColumns.length - 1 || shouldShowMonthLabel(dateColumns[i + 1], i + 1)">
                <span class="month-label">{{ formatMonthLabel(date) }}</span>
              </div>
            </ng-container>
          </ng-container>

           <!--æ—¥ä»˜ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œ-->
          <div class="grid-date-column" [class.today]="isToday(date)" 
            [style.grid-row]="getHeaderRow()"
            *ngFor="let date of dateColumns">
            <span class="date-label" [title]="formatDateFull(date)">{{ formatDay(date) }}</span>
          </div>
      
          <!-- ã‚¿ã‚¹ã‚¯è¡Œ -->
          <ng-container *ngIf="viewMode === 'tasks'">
            <ng-container *ngIf="ganttTasks.length > 0">
              <ng-container *ngFor="let ganttTask of ganttTasks; let rowIndex = index">

              <!-- ã‚¿ã‚¹ã‚¯ãƒ©ãƒ™ãƒ« -->
              <div class="grid-task-label" 
                [style.grid-column]="1"
                [style.grid-row]="getGridRow(rowIndex)">
                <span class="status-dot" [style.background-color]="getStatusColor(ganttTask.task.status)"></span>
                <span class="task-title" (click)="viewTask(ganttTask.task.id)">{{ ganttTask.task.title }}</span>
              </div>
              
              <!-- å„æ—¥ä»˜åˆ—ï¼ˆèƒŒæ™¯ç”¨ã€äºŒåˆ—ç›®ä»¥é™ï¼‰-->
              <div class="grid-date-cell" 
                [class.today]="isToday(date)" 
                [style.grid-row]="getGridRow(rowIndex)"
                [style.grid-column]="i+2"
                *ngFor="let date of dateColumns; let i = index">
                <!--ç©ºã®ã‚»ãƒ«ï¼ˆèƒŒæ™¯ã®ã¿ï¼‰-->
              </div>

              <!-- ãƒãƒ¼æœ¬ä½“ -->
                <div class="grid-bar-overlay" 
                     [style.grid-column]="getBarGridColumn(ganttTask)"
                     [style.grid-row]="getGridRow(rowIndex)">
                  <div class="grid-bar-unified"
                     [style.background-color]="getStatusColor(ganttTask.task.status)"
                     [class.truncated-start]="ganttTask.isStartTruncated"
                     [class.truncated-end]="ganttTask.isEndTruncated"
                     [class.dragging]="isDragging && draggingTaskId === ganttTask.task.id"
                     (mouseenter)="onTaskHover($event, ganttTask)"
                     (mouseleave)="onTaskLeave()"
                     (mousedown)="onBarDragStart($event, ganttTask.task.id, ganttTask.task.startDate.toDate(), ganttTask.task.endDate.toDate())">
                    <!-- å·¦ç«¯ãƒ‰ãƒ©ãƒƒã‚°ãƒãƒ³ãƒ‰ãƒ« -->
                    <div class="drag-handle drag-handle-start"
                         *ngIf="!ganttTask.isStartTruncated"
                         (mousedown)="onDragStart($event, ganttTask.task.id, ganttTask.task.startDate.toDate())"
                         (click)="$event.stopPropagation()">
                    </div>
                    <span class="bar-duration">
                      {{ ganttTask.actualDurationDays ? ganttTask.actualDurationDays : ganttTask.durationDays }}æ—¥
                    </span>
                    <!-- å³ç«¯ãƒ‰ãƒ©ãƒƒã‚°ãƒãƒ³ãƒ‰ãƒ« -->
                    <div class="drag-handle drag-handle-end"
                         *ngIf="!ganttTask.isEndTruncated"
                         (mousedown)="onDragEndStart($event, ganttTask.task.id, ganttTask.task.endDate.toDate())"
                         (click)="$event.stopPropagation()">
                    </div>
                  </div>
                </div>
              </ng-container>
            </ng-container>
            <!-- ã‚¿ã‚¹ã‚¯ãŒãªã„å ´åˆ -->
            <ng-container *ngIf="ganttTasks.length === 0">
              <div class="grid-task-label" [style.grid-column]="1" [style.grid-row]="getGridRow(0)">
                <span class="task-title no-tasks-label">ã‚¿ã‚¹ã‚¯ãŒã‚ã‚Šã¾ã›ã‚“</span>
              </div>
              <div class="grid-date-cell" 
                [class.today]="isToday(date)" 
                [style.grid-row]="getGridRow(0)"
                [style.grid-column]="i+2"
                *ngFor="let date of dateColumns; let i = index">
              </div>
            </ng-container>
          </ng-container>

          <!-- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¡Œ -->
          <ng-container *ngIf="viewMode === 'projects'">
            <ng-container *ngIf="ganttProjects.length > 0">
              <ng-container *ngFor="let ganttProject of ganttProjects; let rowIndex = index">
              <!-- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ©ãƒ™ãƒ« -->
              <div class="grid-task-label" [style.grid-column]="1" [style.grid-row]="getGridRow(rowIndex)">
                <span class="status-dot" [style.background-color]="getProjectColor(ganttProject.project.completionRate)"></span>
                <span class="task-title" (click)="viewProject(ganttProject.project.id)">{{ ganttProject.project.name }}</span>
              </div>
              
              <!-- å„æ—¥ä»˜ã‚»ãƒ« -->
              <div class="grid-date-cell" 
                [class.today]="isToday(date)"
                [style.grid-column]="i+2" 
                [style.grid-row]="getGridRow(rowIndex)"
                *ngFor="let date of dateColumns; let i = index">
               <!--ç©ºã®ã‚»ãƒ«ï¼ˆèƒŒæ™¯ã®ã¿ï¼‰-->
              </div>

              <!-- ãƒãƒ¼æœ¬ä½“ -->
                <div class="grid-bar-overlay" 
                     [style.grid-column]="getBarGridColumn(ganttProject)"
                     [style.grid-row]="getGridRow(rowIndex)"
                     (mousedown)="onProjectBarDragStart($event, ganttProject.project.id, ganttProject.project.startDate.toDate(), ganttProject.project.endDate.toDate())"
                     (click)="viewProject(ganttProject.project.id)">
                  <div class="grid-bar-unified"   
                     [style.background-color]="getProjectColor(ganttProject.project.completionRate)"
                     [class.truncated-start]="ganttProject.isStartTruncated"
                     [class.truncated-end]="ganttProject.isEndTruncated"
                     (mouseenter)="onProjectHover($event, ganttProject)"
                     (mouseleave)="onProjectLeave()">   
                    <!-- å·¦ç«¯ãƒ‰ãƒ©ãƒƒã‚°ãƒãƒ³ãƒ‰ãƒ« -->
                    <div class="drag-handle drag-handle-start"
                         *ngIf="!ganttProject.isStartTruncated"
                         (mousedown)="onProjectDragStart($event, ganttProject.project.id, ganttProject.project.startDate.toDate())"
                         (click)="$event.stopPropagation()">
                    </div>
                    <span class="bar-duration">
                      {{ ganttProject.actualDurationDays || ganttProject.durationDays }}æ—¥
                    </span>
                    <!-- å³ç«¯ãƒ‰ãƒ©ãƒƒã‚°ãƒãƒ³ãƒ‰ãƒ« -->
                    <div class="drag-handle drag-handle-end"
                         *ngIf="!ganttProject.isEndTruncated"
                         (mousedown)="onProjectDragEndStart($event, ganttProject.project.id, ganttProject.project.endDate.toDate())"
                         (click)="$event.stopPropagation()">
                    </div>
                  </div>
                </div>
              </ng-container>
            </ng-container>
            <!-- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒãªã„å ´åˆ -->
            <ng-container *ngIf="ganttProjects.length === 0">
              <div class="grid-task-label" [style.grid-column]="1" [style.grid-row]="getGridRow(0)">
                <span class="task-title no-tasks-label">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒã‚ã‚Šã¾ã›ã‚“</span>
              </div>
              <div class="grid-date-cell" 
                [class.today]="isToday(date)" 
                [style.grid-row]="getGridRow(0)"
                [style.grid-column]="i+2"
                *ngFor="let date of dateColumns; let i = index">
              </div>
            </ng-container>
          </ng-container>
        </div>
      </div>
    </div>
  </div>

  <!-- ã‚¿ã‚¹ã‚¯ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ— -->
  <div class="task-tooltip" 
       *ngIf="hoveredTask"
       [style.left.px]="tooltipPosition.x"
       [style.top.px]="tooltipPosition.y">
    <div class="tooltip-content">
      <div class="tooltip-row">
        <span class="tooltip-label">ã‚¿ã‚¹ã‚¯å:</span>
        <span class="tooltip-value">{{ hoveredTask.task.title }}</span>
      </div>
      <div class="tooltip-row">
        <span class="tooltip-label">é‡è¦åº¦:</span>
        <span class="tooltip-value">{{ getPriorityLabel(hoveredTask.task.priority) }}</span>
      </div>
      <div class="tooltip-row">
        <span class="tooltip-label">æ‹…å½“è€…:</span>
        <span class="tooltip-value">{{ hoveredTask.task.assigneeName || 'æœªè¨­å®š' }}</span>
      </div>
      <div class="tooltip-row">
        <span class="tooltip-label">é€²æ—ç‡:</span>
        <span class="tooltip-value">{{ getProgressPercentage(hoveredTask.task) }}%</span>
      </div>
      <div class="tooltip-row">
        <span class="tooltip-label">æœŸé–“:</span>
        <span class="tooltip-value">{{ formatTaskPeriod(hoveredTask.task) }}</span>
      </div>
      <div class="tooltip-row">
        <span class="tooltip-label">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå:</span>
        <span class="tooltip-value">{{ hoveredTask.task.projectName || 'æœªè¨­å®š' }}</span>
      </div>
      <div class="tooltip-row" *ngIf="hoveredTask.task.teamId">
        <span class="tooltip-label">ãƒãƒ¼ãƒ å:</span>
        <span class="tooltip-value">{{ hoveredTask.task.teamName || 'æœªè¨­å®š' }}</span>
      </div>
    </div>
  </div>

  <!-- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ— -->
  <div class="task-tooltip" 
       *ngIf="hoveredProject"
       [style.left.px]="tooltipPosition.x"
       [style.top.px]="tooltipPosition.y">
    <div class="tooltip-content">
      <div class="tooltip-row">
        <span class="tooltip-label">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå:</span>
        <span class="tooltip-value">{{ hoveredProject.project.name }}</span>
      </div>
      <div class="tooltip-row">
        <span class="tooltip-label">é€²æ—ç‡:</span>
        <span class="tooltip-value">
          {{ hoveredProject.project.completionRate }}%
          ( {{ hoveredProject.project.completedTasks }} / {{ hoveredProject.project.totalTasks }} å®Œäº† )
        </span>
      </div>
      <div class="tooltip-row">
        <span class="tooltip-label">æœŸé–“:</span>
        <span class="tooltip-value">{{ formatProjectPeriod(hoveredProject.project) }}</span>
      </div>
      <div class="tooltip-row" *ngIf="hoveredProject.project.teamId">
        <span class="tooltip-label">ãƒãƒ¼ãƒ å:</span>
        <span class="tooltip-value">{{ hoveredProject.project.teamName || 'æœªè¨­å®š' }}</span>
      </div>
    </div>
  </div>

  <!-- æ—¥ä»˜ç·¨é›†ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ï¼ˆ1ã‹æœˆè¡¨ç¤ºæ™‚ï¼‰ -->
  <div class="date-edit-dialog-overlay" *ngIf="showDateEditDialog" (click)="cancelDateEdit()">
    <div class="date-edit-dialog" (click)="$event.stopPropagation()">
      <h3>æœŸé–“ã‚’è©³ç´°ã«è¨­å®š</h3>
      <div class="dialog-content" *ngIf="editingStartDate && editingEndDate">
        <div class="form-group">
          <label>é–‹å§‹æ—¥:</label>
          <input type="date" [value]="formatDateForInput(editingStartDate)" (input)="onStartDateChange($any($event.target).value)">
        </div>
        <div class="form-group">
          <label>çµ‚äº†æ—¥:</label>
          <input type="date" [value]="formatDateForInput(editingEndDate)" (input)="onEndDateChange($any($event.target).value)">
        </div>
      </div>
      <div class="dialog-actions">
        <button class="btn-cancel" (click)="cancelDateEdit()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        <button class="btn-confirm" (click)="confirmDateEdit()">ä¿å­˜</button>
      </div>
    </div>
  </div>
</div>
</div>

