<div class="task-list-container">
    <!--ãƒ˜ãƒƒãƒ€ãƒ¼éƒ¨åˆ†-->
    <header class="header">
        <div class="header-left">
            <button class="back-btn" (click)="goBack()">â† æˆ»ã‚‹</button>
            <h1>ã‚¿ã‚¹ã‚¯ä¸€è¦§</h1>
        </div>
        <div class="header-right">
            <!-- è¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆãƒœã‚¿ãƒ³ -->
            <div class="view-mode-selector">
                <button 
                    class="view-mode-btn" 
                    [class.active]="viewMode === 'card'"
                    (click)="switchViewMode('card')"
                    title="ã‚«ãƒ¼ãƒ‰è¡¨ç¤º">
                    ğŸ“‹
                </button>
                <button 
                    class="view-mode-btn" 
                    [class.active]="viewMode === 'table'"
                    (click)="switchViewMode('table')"
                    title="ãƒªã‚¹ãƒˆè¡¨ç¤º">
                    ğŸ“Š
                </button>
            </div>
            <button class="create-btn" (click)="openCreateTaskModal()">+ ã‚¿ã‚¹ã‚¯ä½œæˆ</button>
        </div>
    </header>

    <!--ãƒ¡ã‚¤ãƒ³è¡¨ç¤º-->
    <main class="main-content">
        <!--ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒ»ã‚½ãƒ¼ãƒˆã‚»ã‚¯ã‚·ãƒ§ãƒ³-->
        <div *ngIf="!isLoading" class="filter-sort-section">
            <div *ngIf="viewMode === 'table'" class="filter-group">
                <label>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:</label>
                <select [(ngModel)]="statusFilter" (change)="onStatusFilterChange(statusFilter)">
                    <option value="all">ã™ã¹ã¦</option>
                    <option value="not_started">æœªç€æ‰‹</option>
                    <option value="in_progress">é€²è¡Œä¸­</option>
                    <option value="overdue">æœŸé™åˆ‡ã‚Œ</option>
                </select>
            </div>
            
            <div class="filter-group">
                <label>å„ªå…ˆåº¦:</label>
                <select [(ngModel)]="priorityFilter" (change)="onPriorityFilterChange(priorityFilter)">
                    <option value="all">ã™ã¹ã¦</option>
                    <option value="important">é‡è¦</option>
                    <option value="normal">æ™®é€š</option>
                    <option value="low">ä½ã‚</option>
                    <option value="none">ãªã—</option>
                </select>
            </div>
            
            <div class="filter-group">
                <label>ã‚¿ã‚¹ã‚¯ã‚¿ã‚¤ãƒ—:</label>
                <select [(ngModel)]="taskTypeFilter" (change)="onTaskTypeFilterChange(taskTypeFilter)">
                    <option value="all">ã™ã¹ã¦</option>
                    <option value="normal">é€šå¸¸</option>
                    <option value="meeting">ä¼šè­°</option>
                    <option value="regular">å®šæœŸ</option>
                    <option value="project">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ</option>
                    <option value="other">ãã®ä»–</option>
                </select>
            </div>
            
            <div class="sort-group">
                <label>ã‚½ãƒ¼ãƒˆ:</label>
                <select [value]="sortBy" (change)="onSortChange($any($event.target).value)">
                    <option value="endDate">æœŸé™é †</option>
                    <option value="createdAt">ç™»éŒ²æ—¥é †</option>
                    <option value="priority">é‡è¦åº¦é †</option>
                    <option value="title">ã‚¿ã‚¤ãƒˆãƒ«é †</option>
                </select>
                <button class="sort-order-btn" (click)="toggleSortOrder()">
                    {{ sortOrder === 'asc' ? 'â†‘' : 'â†“' }}
                </button>
            </div>
        </div>

        <!--ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º-->
        <div *ngIf="isLoading" class="loading">
            <div class="spinner"></div>
            èª­ã¿è¾¼ã¿ä¸­...
        </div>

        <!--ã‚¿ã‚¹ã‚¯ãŒãªã„å ´åˆ-->
        <div *ngIf="!isLoading && tasks.length === 0" class="no-tasks">
            <div class="empty-state">
                <h3>ã‚¿ã‚¹ã‚¯ãŒã‚ã‚Šã¾ã›ã‚“</h3>
                <p>æ–°ã—ã„ã‚¿ã‚¹ã‚¯ã‚’ä½œæˆã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼</p>
                <button class="create-btn" (click)="openCreateTaskModal()">+ æœ€åˆã®ã‚¿ã‚¹ã‚¯ã‚’ä½œæˆ</button>
            </div>
        </div>

        <!--ã‚«ãƒ¼ãƒ‰è¡¨ç¤ºï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰-->
        <div *ngIf="viewMode === 'card' && !isLoading && tasks.length > 0" class="task-groups-container">
            <ng-container *ngFor="let groupKey of ['not_started', 'in_progress', 'overdue']">
            <div class="task-group">
                
                <!--ã‚°ãƒ«ãƒ¼ãƒ—ãƒ˜ãƒƒãƒ€ãƒ¼-->
                <div class="group-header" [style.border-left-color]="getGroupColor(groupKey)">
                    <h3>{{ getGroupTitle(groupKey) }}</h3>
                    <span class="task-count">{{ taskGroups[groupKey].length }}ä»¶</span>
                </div>

                <!--ã‚°ãƒ«ãƒ¼ãƒ—å†…ã®ã‚¿ã‚¹ã‚¯ï¼ˆã‚ã‚‹å ´åˆï¼‰-->
                <div class="group-tasks" *ngIf="taskGroups[groupKey].length > 0">
                    <div *ngFor="let task of taskGroups[groupKey]" 
                         class="task-card" 
                         [class.overdue-start-date]="isOverdueStartDate(task)"
                         [title]="isOverdueStartDate(task) ? 'é–‹å§‹æ—¥ãŒéãã¦ã„ã¾ã™' : ''"
                         (click)="viewTaskDetail(task.id)">

                        <!--ã‚¿ã‚¹ã‚¯ã‚¿ã‚¤ãƒˆãƒ«-->
                        <h4 class="task-title">{{ task.title }}</h4>

                        <!--ãƒãƒ¼ãƒ åï¼ˆã‚ã‚‹å ´åˆã®ã¿ï¼‰-->
                        <p *ngIf="task.teamName" class="team-name">ãƒãƒ¼ãƒ : {{ task.teamName }}</p>

                        <!--èª¬æ˜æ–‡ï¼ˆã‚ã‚‹å ´åˆã®ã¿ï¼‰-->
                        <p *ngIf="task.description" class="task-description">{{ task.description }}</p>

                        <!--ã‚¿ã‚¹ã‚¯ãƒ¡ã‚¿æƒ…å ±-->
                        <div class="task-meta">
                            <span class="due-date">æœŸé™: {{ formatDate(task.endDate) }}</span>
                        </div>

                        <!--ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæƒ…å ±ï¼ˆã‚ã‚‹å ´åˆã®ã¿ï¼‰-->
                        <div *ngIf="task.projectId" class="project-info-flex">
                            <span class="project-info">
                              ğŸ“ {{ task.projectName }}
                            </span>
                        </div>

                        
                    </div>
                </div>

                <!--ã‚°ãƒ«ãƒ¼ãƒ—å†…ã«ã‚¿ã‚¹ã‚¯ãŒãªã„å ´åˆ-->
                <div class="group-empty" *ngIf="taskGroups[groupKey].length === 0">
                    <p class="empty-message">ã‚¿ã‚¹ã‚¯ãŒã‚ã‚Šã¾ã›ã‚“</p>
                </div>
            </div>
            </ng-container>
        </div>

        <!--ãƒ†ãƒ¼ãƒ–ãƒ«è¡¨ç¤ºï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰-->
        <div *ngIf="viewMode === 'table' && !isLoading && filteredTasks.length > 0" class="table-container">
            <div class="table-actions" *ngIf="filteredTasks.length > 0">
                <button class="select-all-btn" (click)="toggleAllTasks()">
                    {{ selectedTasks.size === filteredTasks.length ? 'å…¨è§£é™¤' : 'å…¨é¸æŠ' }}
                </button>
                <button 
                    *ngIf="selectedTasks.size > 0" 
                    class="delete-selected-btn" 
                    (click)="deleteSelectedTasks()">
                    é¸æŠã—ãŸ{{ selectedTasks.size }}ä»¶ã‚’å‰Šé™¤
                </button>
            </div>
            <table class="task-table">
                <thead>
                    <tr>
                        <th class="check-column"></th>
                        <th>ã‚¿ã‚¤ãƒˆãƒ«</th>
                        <th>æœŸé™</th>
                        <th>é‡è¦åº¦</th>
                        <th>æ‹…å½“</th>
                        <th>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
                        <th>ä½œæ¥­æ™‚é–“</th>
                    </tr>
                </thead>
                <tbody>
                    <tr 
                        *ngFor="let task of filteredTasks" 
                        class="task-row"
                        [class.overdue-start-date]="isOverdueStartDate(task)">
                        <td class="check-column">
                            <input 
                                type="checkbox" 
                                [checked]="selectedTasks.has(task.id)"
                                (change)="toggleTaskSelection(task.id)"
                                (click)="$event.stopPropagation()">
                        </td>
                        <td class="title-cell" (click)="viewTaskDetail(task.id)">
                            <strong>{{ task.title }}</strong>
                            <span *ngIf="task.teamName" class="team-name">ï¼ˆãƒãƒ¼ãƒ : {{ task.teamName }}ï¼‰</span>
                        </td>
                        <td>{{ formatDate(task.endDate) }}</td>
                        <td>
                            <span class="priority-badge" [ngClass]="'priority-' + task.priority">
                                {{ getPriorityLabel(task.priority) }}
                            </span>
                        </td>
                        <td>{{ getAssigneeName(task) }}</td>
                        <td>
                            <span class="status-badge" [ngClass]="'status-' + task.status">
                                {{ getStatusLabel(task.status) }}
                            </span>
                        </td>
                        <td>{{ formatWorkTime(task.totalWorkTime) }}</td>
                    </tr>
                </tbody>
            </table>
            
            <div *ngIf="filteredTasks.length === 0" class="no-tasks-table">
                <p>ã‚¿ã‚¹ã‚¯ãŒã‚ã‚Šã¾ã›ã‚“</p>
            </div>
        </div>
    </main>
</div>
