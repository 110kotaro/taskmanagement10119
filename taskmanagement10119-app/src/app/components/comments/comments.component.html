<div class="comments-container">
  <header class="header">
    <button class="back-btn" (click)="goBack()">â† æˆ»ã‚‹</button>
    <h1>ğŸ’¬ ã‚³ãƒ¡ãƒ³ãƒˆä¸€è¦§</h1>
  </header>

  <main class="main-content">
    <!-- ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒ»æ¤œç´¢ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    <div class="filters-section">
      <!-- æ¤œç´¢çª“ -->
      <div class="search-box">
        <input 
          type="text" 
          placeholder="ã‚³ãƒ¡ãƒ³ãƒˆã‚’æ¤œç´¢..."
          [(ngModel)]="searchKeyword"
          (input)="onSearchChange()"
          class="search-input">
      </div>

      <!-- ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ -->
      <div class="filters">
        <div class="filter-group autocomplete-group">
          <label>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ:</label>
          <div class="autocomplete-wrapper">
            <input 
              type="text" 
              placeholder="ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã‚’å…¥åŠ›..."
              [(ngModel)]="projectNameInput"
              (ngModelChange)="onProjectNameChange($event)"
              (focus)="onProjectNameInput()"
              (blur)="hideProjectSuggestions()"
              class="autocomplete-input">
            <button *ngIf="projectNameInput" 
                    class="clear-btn" 
                    (click)="clearProjectFilter(); $event.stopPropagation()"
                    type="button">Ã—</button>
            <div class="autocomplete-dropdown" *ngIf="showProjectSuggestions && filteredProjectSuggestions.length > 0">
              <div *ngFor="let project of filteredProjectSuggestions" 
                   class="autocomplete-item"
                   (mousedown)="selectProject(project); $event.preventDefault()">
                {{ project.name }}
              </div>
            </div>
          </div>
        </div>

        <div class="filter-group autocomplete-group">
          <label>ã‚¿ã‚¹ã‚¯:</label>
          <div class="autocomplete-wrapper">
            <input 
              type="text" 
              placeholder="ã‚¿ã‚¹ã‚¯åã‚’å…¥åŠ›..."
              [(ngModel)]="taskNameInput"
              (ngModelChange)="onTaskNameChange($event)"
              (focus)="onTaskNameInput()"
              (blur)="hideTaskSuggestions()"
              class="autocomplete-input">
            <button *ngIf="taskNameInput" 
                    class="clear-btn" 
                    (click)="clearTaskFilter(); $event.stopPropagation()"
                    type="button">Ã—</button>
            <div class="autocomplete-dropdown" *ngIf="showTaskSuggestions && filteredTaskSuggestions.length > 0">
              <div *ngFor="let task of filteredTaskSuggestions" 
                   class="autocomplete-item"
                   (mousedown)="selectTask(task); $event.preventDefault()">
                {{ task.title }}
              </div>
            </div>
          </div>
        </div>

        <div class="filter-group">
          <label>æŠ•ç¨¿è€…:</label>
          <select [(ngModel)]="selectedUserId" (change)="onFilterChange()">
            <option value="all">ã™ã¹ã¦</option>
            <option *ngFor="let member of teamMembers" [value]="member.id">
              {{ member.name }}
            </option>
          </select>
        </div>

        <div class="filter-group">
          <label>æŠ•ç¨¿æ—¥:</label>
          <select [(ngModel)]="selectedDateRange" (change)="onFilterChange()">
            <option value="all">ã™ã¹ã¦</option>
            <option value="today">ä»Šæ—¥</option>
            <option value="week">ä»Šé€±</option>
            <option value="month">ä»Šæœˆ</option>
            <option value="custom">æœŸé–“æŒ‡å®š</option>
          </select>
        </div>

        <div class="filter-group" *ngIf="selectedDateRange === 'custom'">
          <label>é–‹å§‹æ—¥:</label>
          <input type="date" [(ngModel)]="customStartDate" (change)="onFilterChange()">
        </div>

        <div class="filter-group" *ngIf="selectedDateRange === 'custom'">
          <label>çµ‚äº†æ—¥:</label>
          <input type="date" [(ngModel)]="customEndDate" (change)="onFilterChange()">
        </div>

        <div class="filter-group">
          <label>æœªèª­/æ—¢èª­:</label>
          <select [(ngModel)]="selectedReadStatus" (change)="onFilterChange()">
            <option value="all">ã™ã¹ã¦</option>
            <option value="read">æ—¢èª­</option>
            <option value="unread">æœªèª­</option>
          </select>
        </div>

        <div class="filter-group">
          <label>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:</label>
          <select [(ngModel)]="selectedTaskStatus" (change)="onFilterChange()">
            <option value="all">ã™ã¹ã¦</option>
            <option value="not_started">æœªç€æ‰‹</option>
            <option value="in_progress">é€²è¡Œä¸­</option>
            <option value="completed">å®Œäº†æ¸ˆã¿</option>
          </select>
        </div>

        <div class="filter-group">
          <label>å„ªå…ˆåº¦:</label>
          <select [(ngModel)]="selectedPriority" (change)="onFilterChange()">
            <option value="all">ã™ã¹ã¦</option>
            <option value="important">é‡è¦</option>
            <option value="normal">æ™®é€š</option>
            <option value="low">ä½ã‚</option>
            <option value="none">ãªã—</option>
          </select>
        </div>

        <div class="filter-group">
          <label>&#64;ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³:</label>
          <select [(ngModel)]="hasMention" (change)="onFilterChange()">
            <option value="all">ã™ã¹ã¦</option>
            <option value="yes">ã‚ã‚Š</option>
            <option value="no">ãªã—</option>
          </select>
        </div>
      </div>
    </div>

    <!-- ã‚³ãƒ¡ãƒ³ãƒˆä¸€è¦§ -->
    <div class="comments-list-container">
      <div *ngIf="isLoading" class="loading">èª­ã¿è¾¼ã¿ä¸­...</div>
      <div *ngIf="!isLoading && filteredComments.length === 0" class="no-comments">
        ã‚³ãƒ¡ãƒ³ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“
      </div>

      <div *ngIf="!isLoading" class="comments-list">
        <div *ngFor="let comment of filteredComments" class="comment-item" (click)="viewTask(comment.taskId)">
          <div class="comment-header">
            <div class="comment-meta-left">
              <span class="comment-author">{{ comment.userName }}</span>
              <span class="comment-date">{{ formatDateTime(comment.createdAt) }}</span>
            </div>
            <div class="comment-meta-right">
              <span class="task-link">ğŸ“ {{ comment.taskTitle }}</span>
              <span *ngIf="comment.projectName" class="project-badge">ğŸ“ {{ comment.projectName }}</span>
            </div>
          </div>
          <div class="comment-content">
            {{ comment.content }}
          </div>
          <div class="comment-footer">
            <span class="status-badge" [ngClass]="'status-' + comment.taskStatus">
              {{ getStatusLabel(comment.taskStatus) }}
            </span>
            <span class="priority-badge" [ngClass]="'priority-' + comment.taskPriority">
              {{ getPriorityLabel(comment.taskPriority) }}
            </span>
            <span *ngIf="comment.content.includes('@')" class="mention-badge">&#64;ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³</span>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>

