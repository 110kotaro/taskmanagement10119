<div class="team-invitation-container">
  <div class="team-invitation-card">
    <div *ngIf="isLoading" class="loading">読み込み中...</div>
    
    <div *ngIf="!isLoading && errorMessage && !invitationInfo" class="error-message">
      <h2>エラー</h2>
      <p>{{ errorMessage }}</p>
      <button class="back-btn" (click)="goBack()">ログイン画面に戻る</button>
    </div>

    <div *ngIf="!isLoading && invitationInfo">
      <div class="header">
        <h1>チーム招待</h1>
        <p class="invitation-info">
          <strong>{{ invitationInfo.invitedByName }}</strong>がチーム「<strong>{{ invitationInfo.teamName }}</strong>」にあなたを招待しました
        </p>
      </div>

      <!-- ユーザータイプ切り替え -->
      <div class="form-group toggle-user-type">
        <label>
          <input 
            type="radio" 
            name="userType" 
            [value]="false"
            [checked]="!isNewUser"
            (change)="toggleNewUser()">
          <span>既存ユーザーでログイン</span>
        </label>
        <label>
          <input 
            type="radio" 
            name="userType" 
            [value]="true"
            [checked]="isNewUser"
            (change)="toggleNewUser()">
          <span>新規ユーザー登録</span>
        </label>
      </div>

      <!-- ログインフォーム -->
      <form [formGroup]="loginForm" (ngSubmit)="onSubmit()" class="invitation-form" *ngIf="!isNewUser">
        <div class="form-group">
          <label for="email">メールアドレス *</label>
          <input 
            type="email" 
            id="email"
            formControlName="email"
            placeholder="メールアドレスを入力">
          <div class="error" *ngIf="loginForm.get('email')?.invalid && loginForm.get('email')?.touched">
            有効なメールアドレスを入力してください
          </div>
        </div>

        <div class="form-group">
          <label for="password">パスワード *</label>
          <input 
            type="password" 
            id="password"
            formControlName="password"
            placeholder="パスワードを入力">
          <div class="error" *ngIf="loginForm.get('password')?.invalid && loginForm.get('password')?.touched">
            パスワードは6文字以上である必要があります
          </div>
        </div>

        <div class="error" *ngIf="errorMessage">{{ errorMessage }}</div>

        <div class="form-actions">
          <button type="button" class="cancel-btn" (click)="goBack()">キャンセル</button>
          <button type="submit" class="submit-btn" [disabled]="loginForm.invalid || isLoading">
            {{ isLoading ? '処理中...' : 'ログインして参加' }}
          </button>
        </div>
      </form>

      <!-- 登録フォーム -->
      <form [formGroup]="signUpForm" (ngSubmit)="onSubmit()" class="invitation-form" *ngIf="isNewUser">
        <div class="form-group">
          <label for="displayName">表示名 *</label>
          <input 
            type="text" 
            id="displayName"
            formControlName="displayName"
            placeholder="表示名を入力">
          <div class="error" *ngIf="signUpForm.get('displayName')?.invalid && signUpForm.get('displayName')?.touched">
            表示名を入力してください
          </div>
        </div>

        <div class="form-group">
          <label for="signup-email">メールアドレス *</label>
          <input 
            type="email" 
            id="signup-email"
            formControlName="email"
            placeholder="メールアドレスを入力">
          <div class="error" *ngIf="signUpForm.get('email')?.invalid && signUpForm.get('email')?.touched">
            有効なメールアドレスを入力してください
          </div>
        </div>

        <div class="form-group">
          <label for="signup-password">パスワード *</label>
          <input 
            type="password" 
            id="signup-password"
            formControlName="password"
            placeholder="パスワードを入力">
          <div class="error" *ngIf="signUpForm.get('password')?.invalid && signUpForm.get('password')?.touched">
            パスワードは6文字以上である必要があります
          </div>
        </div>

        <div class="form-group">
          <label for="confirmPassword">パスワード確認 *</label>
          <input 
            type="password" 
            id="confirmPassword"
            formControlName="confirmPassword"
            placeholder="パスワードを再入力">
          <div class="error" *ngIf="signUpForm.get('confirmPassword')?.invalid && signUpForm.get('confirmPassword')?.touched">
            パスワードを再入力してください
          </div>
        </div>

        <div class="error" *ngIf="errorMessage">{{ errorMessage }}</div>

        <div class="form-actions">
          <button type="button" class="cancel-btn" (click)="goBack()">キャンセル</button>
          <button type="submit" class="submit-btn" [disabled]="signUpForm.invalid || isLoading">
            {{ isLoading ? '処理中...' : '登録して参加' }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

